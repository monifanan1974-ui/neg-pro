Excellent. This is a critical and professional rule. Understood.

Rule #1: All project code, comments, UI, and output will be in English only.

I will now adhere strictly to this rule. Let's restart our process, applying this translation rule first, and then fixing the startup error.

Phase 1: Code and UI Translation

The following files contain Hebrew text in the UI or comments. I will provide their fully translated English versions.

✅ Update the file public/demo.html:
This file contains Hebrew UI text that needs to be translated.

code
Html
download
content_copy
expand_less

--- START OF FILE demo.html ---
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>NegotiationPro – Questionnaire Demo</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:#0b1220;color:#f0f4ff}
  .wrap{max-width:1000px;margin:24px auto;padding:0 16px}
  h1{font-size:22px;margin:0 0 8px}
  p{color:#9fb3d4;margin:0 0 16px}
  .row{display:flex;gap:12px;align-items:center;margin:12px 0}
  button{background:#58a6ff;border:0;color:#0b1220;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer}
  button:disabled{opacity:.6;cursor:not-allowed}
  textarea,pre{width:100%;background:#121a2b;color:#f0f4ff;border:1px solid #1f2a44;border-radius:10px;padding:10px}
  iframe{width:100%;height:520px;border:1px solid #1f2a44;border-radius:14px;background:#121a2b}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  .card{background:#121a2b;border:1px solid #1f2a44;border-radius:14px;padding:14px}
  small{color:#9fb3d4}
</style>
</head>
<body>
<div class="wrap">
  <h1>Questionnaire → Report (Smoke Test)</h1>
  <p>Click the button. This sends demo answers to /questionnaire/report and displays the returned HTML.</p>

  <div class="grid">
    <div class="card">
      <div class="row">
        <button id="run">Run Test</button>
        <small id="status"></small>
      </div>
      <textarea id="payload" rows="14"></textarea>
      <div class="row"><small>You can edit the JSON before running.</small></div>
    </div>

    <div class="card">
      <iframe id="viewer" title="Report Preview"></iframe>
    </div>
  </div>

  <div class="card" style="margin-top:16px">
    <h3 style="margin:0 0 8px">Raw Response (debug)</h3>
    <pre id="debug" style="height:180px;overflow:auto"></pre>
  </div>
</div>

<script>
const sample = {
  "questionnaire": {
    "q_persona_desc": "The Collaborator",
    "q_power": "peer",
    "q_user_style": "Analytical",
    "q_salary_target": "78000",
    "q_benefits": ["remote_work","learning_budget"],
    "q_country": "UK",
    "q_risk": 3,
    "q_prior_offers": "none",
    "q_deadline": "firm",
    "q_market_sources": ["Glassdoor","Levels.fyi"],
    "q_failed": ["budget_limitations"]
  }
};

const $payload = document.getElementById('payload');
const $run = document.getElementById('run');
const $status = document.getElementById('status');
const $viewer = document.getElementById('viewer');
const $debug = document.getElementById('debug');

$payload.value = JSON.stringify(sample, null, 2);

$run.onclick = async () => {
  try {
    $run.disabled = true;
    $status.textContent = 'Working...';
    const body = JSON.parse($payload.value);

    const res = await fetch('/questionnaire/report', {
      method: 'POST',
      headers: { 'Content-Type':'application/json' },
      body: JSON.stringify(body)
    });

    const data = await res.json();
    $debug.textContent = JSON.stringify(data, null, 2);

    if (data && data.html) {
      const blob = new Blob([String(data.html)], {type:'text/html'});
      const url = URL.createObjectURL(blob);
      $viewer.src = url;
      $status.textContent = 'Done ✓';
    } else {
      $status.textContent = 'No HTML returned';
    }
  } catch (e) {
    console.error(e);
    $status.textContent = 'Error – see console';
  } finally {
    $run.disabled = false;
  }
};
</script>
</body>
</html>

✅ Update the file frontend/index.html:
This file also contains Hebrew UI hints.

code
Html
download
content_copy
expand_less
IGNORE_WHEN_COPYING_START
IGNORE_WHEN_COPYING_END
--- START OF FILE index.html ---
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>NegotiationPro — Smart Questionnaire</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{--bg:#0b1220;--panel:#0f172a;--text:#e5e7eb;--muted:#94a3b8;--accent:#60a5fa;--ok:#22c55e;--err:#ef4444}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Arial}
    header{padding:14px 18px;border-bottom:1px solid #1f2937;background:#0c1426}
    .wrap{display:grid;grid-template-columns:1.4fr 1fr;gap:16px;padding:18px}
    .card{background:var(--panel);border:1px solid #1f2937;border-radius:12px;overflow:hidden}
    .card h3{margin:0;padding:12px 14px;border-bottom:1px solid #1f2937;background:#0e1931;font-size:15px}
    .body{padding:14px}
    label{display:block;font-size:12px;color:var(--muted);margin:10px 0 6px}
    input,select,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #22314d;background:#0c1426;color:var(--text)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .btns{display:flex;gap:8px;margin-top:12px}
    button{padding:10px 14px;border-radius:10px;border:1px solid #22314d;background:#12203a;color:#fff;cursor:pointer}
    button.primary{background:var(--accent);border-color:#3b82f6}
    button:disabled{opacity:.5;cursor:not-allowed}
    .json{font-family:ui-monospace,Menlo,Consolas,monospace;background:#0b1326;color:#e5e7eb;border:1px solid #1f2937;border-radius:10px;padding:10px;height:260px;overflow:auto;white-space:pre-wrap}
    #report{min-height:360px;padding:0;margin:0;border:0}
    .hint{font-size:12px;color:var(--muted);margin-top:6px}
    .ok{color:var(--ok)} .err{color:var(--err)}
  </style>
</head>
<body>
  <header>
    <strong>NegotiationPro</strong> <span style="color:#94a3b8">/ Smart Questionnaire</span>
  </header>

  <div class="wrap">
    <!-- Left: Form -->
    <section class="card">
      <h3>Answer the steps</h3>
      <div class="body">
        <div class="row">
          <div>
            <label for="role">Role / Target Title</label>
            <input id="role" placeholder="Senior Editor" />
          </div>
          <div>
            <label for="seniority">Seniority</label>
            <select id="seniority">
              <option value="junior">junior</option>
              <option value="mid" selected>mid</option>
              <option value="senior">senior</option>
              <option value="lead">lead</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="country">Country</label>
            <input id="country" placeholder="UK" />
          </div>
          <div>
            <label for="industry">Industry</label>
            <input id="industry" placeholder="Tech" />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="communication_style">Communication Style</label>
            <input id="communication_style" placeholder="Analytical / Diplomatic / Direct" />
          </div>
          <div>
            <label for="counterpart_persona">Counterpart Persona (optional)</label>
            <input id="counterpart_persona" placeholder="The Friend / The Analyst / The Dominator" />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="range_low">Range Low</label>
            <input id="range_low" placeholder="£65k" />
          </div>
          <div>
            <label for="range_high">Range High</label>
            <input id="range_high" placeholder="£85k" />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="target_salary">Target / Anchor (optional)</label>
            <input id="target_salary" placeholder="£82k" />
          </div>
          <div>
            <label for="market_sources">Market Sources</label>
            <input id="market_sources" placeholder="Glassdoor, Levels.fyi" />
          </div>
        </div>

        <div class="btns">
          <button id="btn-build" class="primary">Build Presentation Report</button>
          <button id="btn-reset" type="button">Reset</button>
          <span id="status" class="hint"></span>
        </div>
      </div>
    </section>

    <!-- Right: Payload preview -->
    <section class="card">
      <h3>Payload Preview</h3>
      <div class="body">
        <div id="preview" class="json">{}</div>
        <div class="hint">The JSON is auto-saved to localStorage and updated in real-time.</div>
      </div>
    </section>
  </div>

  <!-- Report -->
  <section class="card" style="margin:0 18px 18px">
    <h3>Report</h3>
    <div class="body">
      <iframe id="report" title="Report" style="width:100%;height:560px;background:#0b1326;border-radius:12px"></iframe>
      <div class="hint">The report is injected into the iframe from the HTML file returned by the API.</div>
    </div>
  </section>

  <script src="/app/report_embed.js"></script>
</body>
</html>

Note on Filenames: For full consistency with Rule #1, you may also want to rename the file data/Maagar_Sofi_994.json to something like data/sofi_kb_994.json. This is optional but recommended.

Phase 2: Fixing the ModuleNotFoundError

Now, let's address the error you encountered. The issue is that api.py cannot find the modules inside the backend directory. The solution is to correct the import paths.

✅ Update the file api.py with the corrected import paths:

code
Python
download
content_copy
expand_less
IGNORE_WHEN_COPYING_START
IGNORE_WHEN_COPYING_END
--- START OF FILE api.py ---
# api.py
from __future__ import annotations
import os
from flask import Flask, request, jsonify, redirect, url_for, send_from_directory
from flask_cors import CORS

HERE = os.path.dirname(__file__)
ROOT = os.path.abspath(HERE)
DATA_DIR = os.path.join(ROOT, "data")

# Corrected path to point inside the 'backend' directory
TEMPLATES_DIR = os.path.join(HERE, "backend", "templates")
FRONTEND_DIR  = os.path.join(ROOT, "frontend")
PUBLIC_DIR    = os.path.join(ROOT, "public")

# Corrected imports to include the 'backend' package prefix
from backend.engine_entrypoint import QuestionnaireEngine
# from backend.battlecard_integration_plus import register_battlecard_routes
from backend.feedback_store import FeedbackStore

app = Flask(__name__, template_folder=TEMPLATES_DIR, static_url_path=None, static_folder=None)
CORS(app)
# register_battlecard_routes(app)
feedback_store = FeedbackStore(data_dir=DATA_DIR)

def _dir(p): return os.path.isdir(p)
def _file(p): return os.path.isfile(p)
def _ls(p):
    try:
        return sorted(os.listdir(p)) if _dir(p) else []
    except Exception:
        return []

@app.get("/health")
def health():
    return jsonify({
        "status": "ok",
        "service": "NegotiationPro API",
        "version": "2025-08-12",
        "frontend_dir": FRONTEND_DIR, "frontend_exists": _dir(FRONTEND_DIR), "frontend_files": _ls(FRONTEND_DIR),
        "public_dir": PUBLIC_DIR,     "public_exists": _dir(PUBLIC_DIR),     "public_files": _ls(PUBLIC_DIR),
        "active_static_root": FRONTEND_DIR if _dir(FRONTEND_DIR) else PUBLIC_DIR
    }), 200

@app.get("/")
def root():
    # Always redirect to /app/ (with a trailing slash) so relative paths resolve correctly.
    return redirect(url_for("app_index_slash"))

# If someone hits /app (no slash), redirect to /app/
@app.get("/app")
def app_index_redirect():
    return redirect(url_for("app_index_slash"))

# Serve the SPA index from frontend/ (or public/ as a fallback)
@app.get("/app/")
def app_index_slash():
    # Try frontend/index.html first
    idx = os.path.join(FRONTEND_DIR, "index.html")
    if _file(idx):
        return send_from_directory(FRONTEND_DIR, "index.html")
    # Fallback to the other index.html (the one with the two columns)
    idx = os.path.join(PUBLIC_DIR, "index.html")
    if _file(idx):
        return send_from_directory(PUBLIC_DIR, "index.html")
    return ("index.html not found. Put it under 'frontend/' (preferred) or 'public/'.", 404)

# Serve assets relative to /app/ → /app/report_embed.js, /app/questionnaire.json, etc.
@app.get("/app/<path:fn>")
def app_assets(fn):
    p = os.path.join(FRONTEND_DIR, fn)
    if _file(p):
        return send_from_directory(FRONTEND_DIR, fn)
    p = os.path.join(PUBLIC_DIR, fn)
    if _file(p):
        return send_from_directory(PUBLIC_DIR, fn)
    return (f"File not found under frontend/ or public/: {fn}", 404)

# Optional direct static routes
@app.get("/frontend/<path:fn>")
def serve_frontend(fn):
    p = os.path.join(FRONTEND_DIR, fn)
    if _file(p):
        return send_from_directory(FRONTEND_DIR, fn)
    return (f"File not found: {p}", 404)

@app.get("/public/<path:fn>")
def serve_public(fn):
    p = os.path.join(PUBLIC_DIR, fn)
    if _file(p):
        return send_from_directory(PUBLIC_DIR, fn)
    return (f"File not found: {p}", 404)

# ---------- API ----------
@app.post("/questionnaire/report")
def questionnaire_report():
    payload = request.get_json(silent=True) or {}
    answers = payload.get("questionnaire") or payload.get("answers") or {}
    if not isinstance(answers, dict) or not answers:
        return jsonify({"status": "error", "reason": "No answers provided (expected JSON with 'questionnaire' or 'answers')."}), 400

    engine = QuestionnaireEngine(debug=os.getenv("DEBUG", "true").lower() in ("1", "true", "yes"))
    result = engine.run(answers)
    http = 200 if (result.get("status") == "ok" and result.get("html")) else 500
    return jsonify(result), http

@app.post("/feedback")
def feedback():
    payload = request.get_json(silent=True) or {}
    feedback_store.add(payload)
    return jsonify({"status": "ok", "aggregate": feedback_store.aggregate()}), 200

@app.get("/feedback/stats")
def feedback_stats():
    return jsonify({"status": "ok", "aggregate": feedback_store.aggregate()}), 200

if __name__ == "__main__":
    port = int(os.getenv("PORT", "5000"))
    debug = os.getenv("DEBUG", "true").lower() in ("1", "true", "yes", "y")
    print("==== NegotiationPro API ====")
    print(f"Listening on http://localhost:{port} (Debug={debug})")
    print(f"[static root] frontend = {FRONTEND_DIR}")
    print(f"[public root] public = {PUBLIC_DIR}")
    app.run(host="0.0.0.0", port=port, debug=debug)
Next Steps

Replace the content of public/demo.html, frontend/index.html, and api.py with the new versions above.

Save the files.

Run the application again from your terminal:

code
Bash
download
content_copy
expand_less
IGNORE_WHEN_COPYING_START
IGNORE_WHEN_COPYING_END
python api.py

I anticipate the error will now change. It will likely be an ImportError from within one of the backend files. This is progress.

Please run the command and share the new terminal output.
